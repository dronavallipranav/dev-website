---
import '../styles/global.css';
import { getCollection } from "astro:content";
let postEntries = await getCollection("posts");
const text = "Hi, I'm Pranav.";
const letters = [...text];
const subheader = "Highly Caffeinated";
const subLetters = [...subheader];
import projects from '../data/projects.js';
---
<section id="about" class="flex justify-center overflow-x-hidden pb-16 pt-5 items-start h-screen md:ml-[5%] sm:ml-[4%] lg:ml-[8%]">

  <div class="container mx-auto flex justify-center">
    <div class="md:w-[60%] flex flex-col items-start pt-2 space-y-2"> 

        
        <h1 class="title-font m-0 sm:text-4xl dark:text-opacity-80 text-3xl font-medium dark:text-titlePurple text-black flex items-center"> 
            <span class="flex flex-wrap">  
                {letters.map((letter, index) => (
                    <span 
                        class="fade-in-letter" 
                        style={`animation-delay: ${index * 0.1}s;`}
                    >
                        {letter === ' ' ? '\u00A0' : letter} 
                    </span>
                ))}
            </span>

            <img src="/mini.gif" alt="Sprite Animation created by PenZilla" class="ml-3 mt-1 fade-in-item" style = {`animation-delay: ${(letters.length) * 0.1}s;`}/> 
        </h1>

        <h1 class="title-font m-0 sm:text-4xl dark:text-opacity-80 text-3xl mb-4 font-medium dark:text-titlePurple text-black">
            <i>
                {subLetters.map((letter,index) => (
                    <span
                        class="fade-in-letter"
                        style={`animation-delay: ${(letters.length + index) * 0.1 + 1}s;`}
                    >
                        {letter === ' ' ? '\u00A0' : letter}
                    </span>
                ))}
            </i>
        </h1>

          <p class="leading-relaxed dark:text-opacity-70 dark:text-gray-300 text-lg py-2">
            Senior at UW-Madison majoring in Computer Science. 
            My hobbies include coding, reading, guitar (electric and classical), chess, volunteering, and video games.
            I also love cats. For any in-person inquiries, You can find me in my office at the CS building during my office hours, or at Peet's Coffee (usually).
        
          <p class="leading-relaxed text-left dark:text-opacity-70 dark:text-gray-300 text-lg mb-6"> 
            Oh, I also write leetcode solutions sometimes (as long as they are informal). <a href = "https://leetcode.com/pdronavalli/" class="underline text-black dark:text-titlePurple dark:hover:text-titlePurpleDark font-bold hover:font-extrabold">  Check them out. </a>
        </p>
        <br>
          <p class = "text-xl dark:text-opacity-70 dark:text-gray-300"> <b> Current Read: </b> <em>For Whom the Bell Tolls</em> </p>
          <div class="flex py-2">
            <a
              href="mailto:dronavallipranav@gmail.com"
              class="inline-flex text-white dark:bg-byz dark:hover:bg-containerGray dark:hover:text-white dark:text-white dark:text-opacity-90 bg-gray-700 border-0 py-2 px-6 focus:outline-none hover:bg-black rounded text-lg">
              Contact Me
            </a>
            <a
              href="/projects"
              class="ml-4 inline-flex dark:bg-opacity-80 dark:bg-gray-300 dark:hover:bg-containerGray bg-gray-300 border-0 py-2 px-6 dark:text-opacity-90 focus:outline-none hover:bg-gray-700 hover:text-white rounded text-lg">
              All Projects
            </a>
          </div>
          <div class="leading-relaxed lg:max-w-lg font-medium text-xl inline-flex bg-opacity-40 p-8 rounded py-2">
          </div>

          <h2 class="title-font sm:text-4xl text-3xl mb-8 font-medium dark:text-opacity-80 dark:text-gray-100 text-black py-2">
           Latest Projects
        </h2>
        

<div>
  {projects.slice(0,2).map(project => (
      <a href={project.link} target="_blank" rel="noopener noreferrer" class="block mb-6 shadow-lg hover:shadow-xl transition-transform duration-300 ease-in-out transform hover:scale-105">
          <div class="parallax flex dark:bg-containerGray bg-gray-50 px-2 py-4 rounded-xl overflow-hidden">
              <div class="w-1/3 border-r rounded-lg border-black border-2">
                  <img src={project.image} alt={project.title} class="w-full rounded-md h-full object-cover"/>
              </div>
              <div class="w-2/3 p-6">
                  <h3 class="text-xl dark:text-titlePurple dark:text-opacity-80 font-semibold mb-2">{project.title} <b class="dark:text-opacity-80 dark:text-gray-100">{project.status}</b></h3>
                  <p class="dark:text-gray-400 dark:text-opacity:70 text-gray-600 hidden lg:block">{project.description}</p>
              <p class="dark:text-gray-400 dark:text-opacity:70 text-gray-600 hidden md:block lg:hidden">{project.description.substring(0, 100)}...</p>
              <p class="dark:text-gray-400 dark:text-opacity:70 text-gray-600 hidden sm:block lg:hidden md:hidden">{project.description.substring(0, 40)}...</p>
              {project.title === "Rust Obfuscator" && (
                            <p class="dark:text-gray-400 font-bold inline dark:text-opacity-70 text-gray-600 download-count"> ...
                            </p>
                            <img src="/download.svg" alt="Download Icon" class="inline dark:hidden align-middle ml-2 h-6 w-6" />
                            <p class="text-sm text-gray-500 dark:text-gray-300 mt-1">Downloads All Time</p>
                        )}
              </div>
          </div>
      </a>
  ))}
      </div>
      
      <h2 class="title-font dark:text-gray-100 dark:text-opacity-80 sm:text-4xl text-3xl mb-4 font-medium text-black py-2">
        Latest Blogs
      </h2>
      {postEntries.slice(0,2).map(blog => (
        <a href={`/posts/${blog.slug}`} class="block mb-8 shadow-lg hover:shadow-xl transition-transform duration-300 ease-in-out transform hover:scale-105">
          <div class="flex parallax dark:bg-containerGray px-2 bg-gray-50 py-4 mt-3 rounded-xl overflow-hidden">

            <div class="w-1/3 border-r rounded-lg border-black border-2">
              <img src={blog.data.image} alt={blog.data.title} class="w-full rounded-md h-full object-cover" />
            </div>

            <div class="w-2/3 p-6">
              <h3 class="text-xl font-semibold dark:text-opacity-80 dark:text-titlePurple mb-2">{blog.data.title}</h3>
              <h2 class="text-lg font-semibold pb-1 mb-2 dark:text-opacity-80 dark:text-gray-200">{blog.data.date}</h2>
              <p class="dark:text-gray-400 dark:text-opacity:70 text-gray-600 hidden lg:block">{blog.data.description}</p>
              <p class="dark:text-gray-400 dark:text-opacity:70 text-gray-600 hidden md:block lg:hidden">{blog.data.description.substring(0, 100)}...</p>
              <p class="dark:text-gray-400 dark:text-opacity:70 text-gray-600 hidden sm:block lg:hidden md:hidden">{blog.data.description.substring(0, 40)}...</p>

            </div>
          </div>
        </a>
      ))}
  
  <h2 class="title-font dark:text-gray-100 dark:text-opacity-80 mt-2 sm:text-4xl text-3xl mb-4 font-medium text-black pt-2">
    PranavBot
  </h2>
  <h4 class="title-font dark:text-gray-100 dark:text-opacity-80 sm:text-xl text-lg mb-4 font-medium text-black">
    Powered by OpenAI and LangChain
  </h4>
  <div 
      class="block w-full max-w-2xl mb-8 mt-4 dark:bg-containerGray shadow-lg transform transition-transform duration-300"
  >
    <div class="flex dark:bg-containerGray bg-gray-50 px-2 py-4 mt-4 mb-2 rounded-xl overflow-hidden">
        <div class="w-full p-6">
            <h3 class="text-xl font-semibold dark:text-opacity-80 dark:text-titlePurple mb-2">PranavBot:</h3>
            <p class="text-lg dark:text-opacity-70 dark:text-gray-300">
                <span id="langchain-text">Ask me anything about Pranav, and I'll assist you to the best of my capability!</span>
            </p>
            <div id="loading-div" class="hidden w-12 h-12">
              <img src="load.gif" alt="Loading..." />
            </div>
        </div>
    </div>

  
<div class="chat-bubble w-full">
  <div class="chat-bubble-content">
    <div class="flex items-center mt-2 mr-2 mb-2 space-x-2">
      <div class="w-10 h-10 ml-2 rounded-full bg-gray-50 dark:bg-containerGray"><img src = "/robot.png"></div>
      <input 
        id="user-question" 
        class="w-full border dark:bg-containerGray dark:text-gray-200 dark:text-opacity-90 rounded-md p-2" 
        type="text" 
        placeholder="What does Pranav like?"
      >
    </div>
  </div>
</div>
</div>

  
  <button 
    id="fetch-langchain-response" 
    class="text-lg px-6 py-2 bg-gray-700 text-white rounded-md mt-2 hover:bg-gray-800 py-2 dark:bg-byz dark:hover:bg-containerGray dark:hover:text-white dark:text-white dark:text-opacity-90 transition-transform duration-300 ease-in-out transform shadow-lg hover:shadow-xl mt-4"
  >
    Ask Anything About Me
  </button>



</div>
</div>
    <script>
    document.getElementById('fetch-langchain-response').addEventListener('click', async () => {
      const question = document.getElementById('user-question').value;
      
      if (!question) {
        alert('Please enter a question.');
        return;
      }

      document.getElementById('langchain-text').textContent = "";
      document.getElementById('loading-div').classList.remove('hidden');
    
      const requestData = {
        question: question
      };
    
      try {
        const response = await fetch("https://jtd1lexbk4.execute-api.us-east-2.amazonaws.com/default/askContainer", {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify(requestData)
});

    
        if (response.ok) {
          const data = await response.json();
          document.getElementById('loading-div').classList.add('hidden');
          document.getElementById('langchain-text').textContent = data.text;
          document.getElementById('langchain-response').classList.remove('hidden');
        } else {
          console.error("Error fetching langchain response:", await response.text());
        }
      } catch (error) {
        console.error("Error:", error);
      }
    });
    </script>
    <script src="/scripts/fetchDownloads.js" is:inline></script>
</section>

